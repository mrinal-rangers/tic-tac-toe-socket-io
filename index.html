<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <title>Tic-Tac-Toe</title>
</head>
<body>
    <h1 id="heading">Tic Tac Toe</h1>
    <div id="players">
        <p id="userContent"> YOU : <span id="user"></span></p>
        <p id="oppNameContent"> OPPONENT : <span id="oppName"></span></p>
    </div>
    <div id="box">
    <p id ="valueCont">You are playing as <span id="value"></span> </p>
    <p id="whosTurn"> X's Turn </p>
    <div id="nameBox">
        <p id="enterName"> Enter Your Name : </p>
        <input type="text" placeholder="Name" id ="name" >
        <button id="findbtn">Search for a player</button>
    </div>
    
    <img src="loading.gif" id ="loading" alt="loading">

    <div id="bigCont">
        <div id="cont">
            <div class="row">
                <button class="btn" id="btn1"></button>
                <button class="btn" id="btn2"></button>
                <button class="btn" id="btn3"></button>
            </div>
            <div class="row">
                <button class="btn" id="btn1"></button>
                <button class="btn" id="btn2"></button>
                <button class="btn" id="btn3"></button>
            </div>
            <div class="row">
                <button class="btn" id="btn1"></button>
                <button class="btn" id="btn2"></button>
                <button class="btn" id="btn3"></button>
            </div>
        </div>

    </div>
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.js"></script>
<script>
    document.getElementById('loading').style.display='none';
    document.getElementById('bigCont').style.display='none';
    document.getElementById('valueCont').style.display='none';
    document.getElementById('whosTurn').style.display='none';
    document.getElementById('players').style.display='none';
    const socket =io();
    let name ;
    document.getElementById('findbtn').addEventListener('click',()=>{
        name = document.getElementById('name').value;
        console.log("clicked",name);
        document.getElementById('user').innerHTML=name;
        document.getElementById('loading').style.display='block';
        if(name === null || name === '') return alert("enter name");
        else{
            socket.emit('find',{name});
            document.getElementById('loading').style.display='block';
        }
        
    })

    socket.on('find',(e)=>{
        let allPlayersArray = e.allPlayers;
        console.log(allPlayersArray);
        document.getElementById('loading').style.display='none';
        document.getElementById('nameBox').style.display='none';
        document.getElementById('bigCont').style.display='block';
        document.getElementById('valueCont').style.display='block';
        document.getElementById('whosTurn').style.display='block';
        document.getElementById('players').style.display='inline';

        let oppName ,value;
        const foundObj = allPlayersArray.find((obj)=>{
            return obj.p1.p1name===name || obj.p2.p2name === name;
        })
            
        oppName = foundObj.p1.p1name === name ? foundObj.p2.p2name : foundObj.p1.p1name ;
        value = foundObj.p1.p1name === name ? foundObj.p1.p1value : foundObj.p2.p2value ;
        document.getElementById('oppName').innerHTML=oppName;
        document.getElementById('value').innerHTML=value;
    })

</script>

</html>